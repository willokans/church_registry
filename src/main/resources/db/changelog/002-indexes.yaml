databaseChangeLog:
  - changeSet:
      id: 015-add-indexes
      author: system
      changes:
        - createIndex:
            indexName: idx_app_users_email
            tableName: app_users
            columns:
              - column:
                  name: email
        - createIndex:
            indexName: idx_app_users_status
            tableName: app_users
            columns:
              - column:
                  name: status
        - createIndex:
            indexName: idx_memberships_user
            tableName: memberships
            columns:
              - column:
                  name: user_id
        - createIndex:
            indexName: idx_memberships_tenant
            tableName: memberships
            columns:
              - column:
                  name: tenant_id
        - createIndex:
            indexName: idx_memberships_status
            tableName: memberships
            columns:
              - column:
                  name: status
        - createIndex:
            indexName: idx_role_permissions_role
            tableName: role_permissions
            columns:
              - column:
                  name: role
        - createIndex:
            indexName: idx_content_blocks_tenant
            tableName: content_blocks
            columns:
              - column:
                  name: tenant_id
        - createIndex:
            indexName: idx_sacrament_events_tenant
            tableName: sacrament_events
            columns:
              - column:
                  name: tenant_id
        - createIndex:
            indexName: idx_sacrament_events_type
            tableName: sacrament_events
            columns:
              - column:
                  name: type
        - createIndex:
            indexName: idx_sacrament_events_date
            tableName: sacrament_events
            columns:
              - column:
                  name: date
        - createIndex:
            indexName: idx_sacrament_events_status
            tableName: sacrament_events
            columns:
              - column:
                  name: status
        - createIndex:
            indexName: idx_sacrament_events_book_page_entry
            tableName: sacrament_events
            columns:
              - column:
                  name: tenant_id
              - column:
                  name: type
              - column:
                  name: book_no
              - column:
                  name: page_no
              - column:
                  name: entry_no
        - createIndex:
            indexName: idx_certificates_event
            tableName: certificates
            columns:
              - column:
                  name: event_id
        - createIndex:
            indexName: idx_audit_logs_tenant
            tableName: audit_logs
            columns:
              - column:
                  name: tenant_id
        - createIndex:
            indexName: idx_audit_logs_actor
            tableName: audit_logs
            columns:
              - column:
                  name: actor_id
        - createIndex:
            indexName: idx_audit_logs_entity
            tableName: audit_logs
            columns:
              - column:
                  name: entity
              - column:
                  name: entity_id
        - createIndex:
            indexName: idx_audit_logs_ts
            tableName: audit_logs
            columns:
              - column:
                  name: ts
        - createIndex:
            indexName: idx_idempotency_tenant_key
            tableName: idempotency_keys
            columns:
              - column:
                  name: tenant_id
              - column:
                  name: key
        - createIndex:
            indexName: idx_idempotency_created
            tableName: idempotency_keys
            columns:
              - column:
                  name: created_at
        - createIndex:
            indexName: idx_outbox_tenant
            tableName: outbox
            columns:
              - column:
                  name: tenant_id
        - createIndex:
            indexName: idx_outbox_status
            tableName: outbox
            columns:
              - column:
                  name: status
        - createIndex:
            indexName: idx_outbox_created
            tableName: outbox
            columns:
              - column:
                  name: created_at

  - changeSet:
      id: 016-partial-unique-index-sacrament-events
      author: system
      changes:
        - sql:
            sql: |
              CREATE UNIQUE INDEX IF NOT EXISTS idx_sacrament_events_unique_active
              ON sacrament_events (tenant_id, type, book_no, page_no, entry_no)
              WHERE status = 'ACTIVE';

